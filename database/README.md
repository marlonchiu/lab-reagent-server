# 实验室试剂管理系统 - 数据库初始化

## 📋 概述

本目录包含实验室试剂管理系统的完整数据库初始化脚本，使用用户名+密码认证方式。

## 🚀 快速开始

### 方法1：一键执行（推荐）

在 Supabase SQL 编辑器中执行：

```sql
-- 复制并执行 database/00-execute-all.sql 的全部内容
```

### 方法2：分步执行

按顺序执行以下脚本：

1. `01-cleanup.sql` - 清空现有数据
2. `02-create-schema.sql` - 创建表结构
3. `03-enable-rls.sql` - 启用行级安全
4. `04-insert-base-data.sql` - 插入基础数据
5. `05-insert-sample-data.sql` - 插入示例数据

## 👥 演示账户

执行完成后，可使用以下账户登录：

| 用户名 | 密码 | 角色 | 姓名 | 说明 |
|--------|------|------|------|------|
| admin | 123456 | 管理员 | 系统管理员 | 可管理所有数据 |
| teacher | 123456 | 导师 | 张教授 | 可审批申请和管理实验室 |
| teacher2 | 123456 | 导师 | 李教授 | 化学分析实验室导师 |
| student | 123456 | 学生 | 张同学 | 可申请试剂和记录使用 |
| student2 | 123456 | 学生 | 李同学 | 生物医学工程实验室学生 |
| student3 | 123456 | 学生 | 王同学 | 化学分析实验室学生 |

## 📊 数据内容

### 基础数据
- **3个实验室**：生物医学工程、化学分析、材料科学
- **6个用户**：1个管理员、2个导师、3个学生
- **10种试剂**：涵盖有机溶剂、无机试剂、生物试剂、指示剂
- **10条库存记录**：包含批次、数量、位置等信息

### 业务数据
- **7个采购申请**：不同状态的申请示例
- **5条审批记录**：包含批准和拒绝的记录
- **15条使用记录**：详细的试剂使用历史

## 🔐 认证系统

- **认证方式**：用户名 + 密码
- **密码加密**：SHA-256 + 盐值 (`lab_reagent_salt`)
- **会话管理**：前端 sessionStorage
- **权限控制**：基于角色的访问控制

## 🛡️ 安全策略

- **RLS启用**：所有表都启用了行级安全
- **当前策略**：宽松策略（适用于自定义认证）
- **生产建议**：根据实际需求调整为更严格的策略

## 📁 文件说明

- `00-execute-all.sql` - 完整的一键执行脚本
- `01-cleanup.sql` - 清空数据库表
- `02-create-schema.sql` - 创建表结构和索引
- `03-enable-rls.sql` - 启用RLS和创建策略
- `04-insert-base-data.sql` - 插入基础数据
- `05-insert-sample-data.sql` - 插入示例业务数据
- `README.md` - 本说明文件

## ⚠️ 注意事项

1. **数据备份**：执行前请备份现有数据
2. **环境确认**：确保在正确的数据库环境中执行
3. **权限检查**：确保有足够的数据库操作权限
4. **密码安全**：生产环境中请修改默认密码

## 🔧 故障排除

### 常见问题

1. **表已存在错误**
   - 先执行 `01-cleanup.sql` 清空数据

2. **权限不足错误**
   - 检查数据库用户权限
   - 确保可以创建表和策略

3. **外键约束错误**
   - 按正确顺序执行脚本
   - 检查引用数据是否存在

### 验证安装

执行以下查询验证安装：

```sql
-- 检查表是否创建成功
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;

-- 检查用户数据
SELECT username, name, role FROM users ORDER BY role, username;

-- 检查库存统计
SELECT COUNT(*) as total_inventory FROM inventory;
```

## 📞 支持

如有问题，请检查：
1. Supabase 连接状态
2. SQL 语法错误
3. 数据库权限设置
4. 前端配置是否正确
